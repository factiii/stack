# ============================================================================
# Factiii Configuration (factiii.yml)
# ============================================================================
#
# This file contains settings that CANNOT be automatically detected.
# All settings with EXAMPLE- prefix MUST be replaced with actual values.
#
# Auto-detected settings are stored separately in factiiiAuto.yml
# See STANDARDS.md for full documentation.
#
# ============================================================================

# ----------------------------------------------------------------------------
# REQUIRED SETTINGS
# ----------------------------------------------------------------------------
# These must be configured before deployment. Factiii will block deployment
# if any EXAMPLE- values remain.

# Repository/Project Name
# Must match your GitHub repository name exactly
name: EXAMPLE-factiii

# GitHub Repository
# Format: owner/repo-name
github_repo: EXAMPLE-yourorg/factiii

# SSL Email for Let's Encrypt
# Used for certificate notifications and account recovery
ssl_email: EXAMPLE-admin@yourdomain.com

# ----------------------------------------------------------------------------
# PLUGINS CONFIGURATION
# ----------------------------------------------------------------------------
# Global plugin defaults. These can be overridden per environment.
#
# Available plugins:
#   secrets: github (default), aws-sm (coming soon), vault (coming soon)
#   registry: ecr (default), dockerhub (coming soon), gcr (coming soon)

plugins:
  secrets: github       # Where to store secrets (GitHub Actions Secrets)
  registry: ecr         # Where to push Docker images

# ----------------------------------------------------------------------------
# SERVERS CONFIGURATION
# ----------------------------------------------------------------------------
# Define your deployment servers with their plugin types.
# Each server can be referenced by name in the environments section.
#
# ⚠️  IMPORTANT: Never put sensitive values (passwords, keys, hostnames) in this file!
# All secrets are stored in GitHub Secrets and will be prompted for when you run:
#   npx factiii fix
#
# The server plugin automatically determines what secrets it needs:
# - mac-mini plugin needs: {ENV}_SSH, {ENV}_HOST, {ENV}_USER
# - aws-ec2 plugin needs: {ENV}_SSH, {ENV}_HOST, {ENV}_USER + AWS credentials
#
# Example: "staging" environment using "mac-mini" server will look for:
#   STAGING_SSH, STAGING_HOST, STAGING_USER in GitHub Secrets

servers:
  mac-mini:
    plugin: mac-mini                # Server provider plugin
    
  aws-ec2-prod:
    plugin: aws-ec2                 # AWS EC2 provider
    region: us-east-1               # AWS region (for auto-provisioning)
    # instance_type: t3.small       # Optional: instance type for auto-provisioning
    # auto_provision: false         # Optional: set to true to auto-create EC2 instances

# ----------------------------------------------------------------------------
# ENVIRONMENTS CONFIGURATION
# ----------------------------------------------------------------------------
# Define your deployment environments. Each environment maps to a server
# and can have environment-specific settings.

environments:
  staging:
    server: mac-mini                # Reference to server defined above
    domain: EXAMPLE-staging.factiii.com
    port: 3001
    env_file: .env.staging          # Local env file to read from
    
  production:
    server: aws-ec2-prod            # Reference to server defined above
    domain: EXAMPLE-factiii.com
    port: 3001
    env_file: .env.prod

  # Example: Additional environments
  # staging2:
  #   server: mac-mini              # Same server, different port
  #   domain: staging2.factiii.com
  #   port: 3010
  #
  # production-west:
  #   server: aws-ec2-west          # Different server (define in servers section)
  #   domain: west.factiii.com
  #   port: 3001

# ----------------------------------------------------------------------------
# AWS ECR CONFIGURATION
# ----------------------------------------------------------------------------
# Container registry for Docker images

# ECR Registry URL
# Format: ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com
ecr_registry: EXAMPLE-123456789.dkr.ecr.us-east-1.amazonaws.com

# ECR Repository Name
ecr_repository: EXAMPLE-apps

# ----------------------------------------------------------------------------
# APPS CONFIGURATION (Optional)
# ----------------------------------------------------------------------------
# Define the applications in your monorepo. Factiii auto-detects these,
# but you can override or add custom settings here.

# apps:
#   - type: nextjs
#     path: apps/web
#     port: 3000
#     health_check: /api/health
#
#   - type: expo
#     path: apps/mobile
#     # Expo apps don't deploy to servers, but Factiii can help with builds
#
#   - type: node-api
#     path: apps/server
#     port: 4000

# ----------------------------------------------------------------------------
# GITHUB SECRETS REFERENCE
# ----------------------------------------------------------------------------
# The following secrets must be configured in GitHub Settings → Secrets.
# Run `npx factiii fix` to set these up interactively.
#
# ┌─────────────────────────────────────────────────────────────────────────┐
# │ SECRET NAME              │ DESCRIPTION                                  │
# ├─────────────────────────────────────────────────────────────────────────┤
# │ STAGING_SSH              │ SSH private key for staging server           │
# │ STAGING_HOST             │ Staging server hostname/IP                   │
# │ STAGING_USER             │ SSH username for staging                     │
# │ PROD_SSH                 │ SSH private key for production server        │
# │ PROD_HOST                │ Production server hostname/IP                │
# │ PROD_USER                │ SSH username for production                  │
# │ AWS_ACCESS_KEY_ID        │ AWS access key for ECR                       │
# │ AWS_SECRET_ACCESS_KEY    │ AWS secret key for ECR                       │
# │ AWS_REGION               │ AWS region (e.g., us-east-1)                 │
# │ STAGING_ENVS             │ Staging env vars (newline-separated)         │
# │ PROD_ENVS                │ Production env vars (newline-separated)      │
# └─────────────────────────────────────────────────────────────────────────┘
#
# ============================================================================
# AUTO-DETECTED SETTINGS (factiiiAuto.yml)
# ============================================================================
# The following settings are auto-detected by running `npx factiii`.
# They are stored in a separate file: factiiiAuto.yml
#
# To override an auto-detected value, use:
#   setting: detected_value OVERRIDE custom_value
#
# Example factiiiAuto.yml:
# ----------------------------------------------------------------------------
# # Stack detection (auto-detected from package.json and project structure)
# has_nextjs: true
# has_expo: true
# has_trpc: true
# has_prisma: true
#
# # Prisma configuration
# prisma_schema: apps/server/prisma/schema.prisma
# prisma_version: 5.7.0
#
# # Dockerfile location
# dockerfile: apps/server/Dockerfile
#
# # Health check endpoint
# health_check: /api/health
#
# # Package manager
# package_manager: pnpm
#
# # Build and test commands
# build_command: pnpm build
# test_command: pnpm test
# ----------------------------------------------------------------------------
#
# ============================================================================
# EXTERNAL PLUGINS (Optional)
# ============================================================================
# You can use community plugins from npm:
#
# plugins:
#   external:
#     - "@factiii/stack-plugin-digitalocean"
#     - "@somedev/factiii-plugin-hetzner"
#
# Then reference them in your servers section:
#
# servers:
#   do-droplet:
#     plugin: digitalocean
#     api_key_secret: DO_API_KEY
#

